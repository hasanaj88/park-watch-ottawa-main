name: Sync Ottawa Parking Lots

on:
  schedule:
    - cron: "*/5 * * * *"   # runs every 5 minutes
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Call Supabase sync function (debug)
        run: |
          echo "Calling SYNC_URL..."
          echo "SYNC_URL length: ${#{{ secrets.SYNC_URL }}}"

          STATUS=$(curl -sS -o response.txt -w "%{http_code}" -X POST "${{ secrets.SYNC_URL }}" \
            -H "x-sync-key: ${{ secrets.SYNC_KEY }}")

          echo "HTTP Status: $STATUS"
          echo "Response:"
          cat response.txt || true

          if [ "$STATUS" -lt 200 ] || [ "$STATUS" -ge 300 ]; then
            echo "Sync failed"
            exit 1
          fi
